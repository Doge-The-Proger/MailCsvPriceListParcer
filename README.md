# Описание задания

На почтовый ящик компании "ООО "Запчасти даром" приходит прайс-лист от поставщика "ООО "Доставим в срок"
Прайс-лист представляет из себя csv файл, образец которого во вложении. В прайсе содержится информация об автозапчастях, которые доставляет поставщик.
Необходимо написать консольное или web приложение, которое скачивает прайс с почтового ящика и загружает в базу.

Входные данные.

Необходимо загрузить в таблицу PriceItems БД (любую реляционную) со структурой
	- Vendor varchar(64) - производитель
	- Number varchar(64) - номер запчасти
	- SearchVendor varchar(64) - производитель для поиска
	- SearchNumber varchar(64) - номер для поиска
	- Description varchar(512) - наименование
	- Price decimal(18,2) - цена
	- Count int - количество

Данные из прайс листа, но только определенные колонки.
Нужные колонки из файла: 
	- "Бренд" загрузить в Vendor
	- "Каталожный номер" загрузить в Number
	- "Описание" загрузить в Description
	- "Цена" в Price
	- "Наличие" в Count

При выполнении задания следует учесть:
	- компании "ООО "Запчасти даром" присылают прайсы несколько поставщиков, поэтому порядок колонок и их наименование
	в прайсе может меняться, поэтому сопоставление колонок нужно конфигурировать в зависимости от поставщика. В данном случае
	достаточно одной конфигурации под поставщика "ООО "Доставим в срок"
	- почтовый ящик так же должен конфигурироваться (использовать протокол IMAP для получения письма). 
	Прайс-лист будет вложением к письму, при чем имя файла не регламентировано, известно только, что расширение .csv
	- при загрузке в базу следует заполнить поля SearchVendor и SearchNumber путем удаления из них всех нецифернобуквенных символов 
	и преобразования к верхнему регистру символов полей Vendor и Number соответственно
	- колонка с количеством может содержать в себе записи вида >10, <13, 10-50. В первом случае нужно загрузить просто 10 и 13, во втором 50
	- колонка "Описание" может содержать более 512 символов, в таком случае необходимо ее обрезать до 512

## Пояснения к решению:

1. Данные подключаемого почтового ящика, почтового ящика поставщика и строка подключения к БД вынесены в конфигурационный файл **appsettings.json**. Примечания по данным:
- Почтовый ящик (**EmailUser**): можно получить у меня или ввести свой(должен быть включен IMAP)
- Пароль (**EmailPassword**): можно получить у меня или использовать пароль от своего ящика, но если IMAP через Gmail, то должна быть включена 2FA и введен сгенерированный пароль приложения.
- Почтовый ящик поставщика (**SupplierEmail**): используется для определения писем, из которых скачивать прайс-лист. Можете использовать свой.
2. В файл **CSVParcerService.cs** была добавлена вынужденная корректировка файла перед парсингом из-за невозможности повлиять на конкретное поле строки 16301, вызывающей ошибку парсинга. Было испробовано несколько способов, сработал только этот.
3. Для обработки полей с int и decimal были добавлены кастомные конвертеры при парсинге для отсечения лишних символов и проверки на корректность числа.
4. Сервис может обработать больше одного письма, и в каждом письме может быть несколько csv файлов, каждый файл будет разобран отдельно, но все письма должны быть помечены как непрочитанные. В файле **MailProcessService.cs** в строке 60 каждому обработанному письму выставляется флаг о том, что оно прочитано. Можно закомментировать эту строку.
5. Использовалась библиотека **CsvHelper**, локальная БД **SQLite** с подключенным **EFCore**. Просмотреть сохраненные в БД строки можно с помощью расширения Visual Studio: **SQL Server Compact & SQLite Toolbox**, открывается через Обозреватель серверов.
